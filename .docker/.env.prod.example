# .docker/.env.prod.example
# Mail Proxy 生產環境變數設定
# 複製此檔案為 .env.prod 並填入實際值

# ============================================
# Environment
# ============================================
APP_ENV=production

# ============================================
# API 設定
# ============================================
API_PORT=8080

# ============================================
# PostgreSQL (連接 MIS 自建的資料庫)
# 格式: postgres://使用者:密碼@主機:埠號/資料庫名?sslmode=disable
# ============================================
DATABASE_URL=postgres://smtp_user:your_password@postgresql-host:5432/smtp_service?sslmode=disable

# ============================================
# RabbitMQ (連接 MIS 自建的訊息佇列)
# 格式: amqp://使用者:密碼@主機:埠號/
# ============================================
RABBITMQ_URL=amqp://admin:your_password@rabbitmq-host:5672/

# ============================================
# Queue 名稱設定
# ============================================
MAIL_QUEUE_NAME=mail-queue
RETRY_QUEUE_NAME=retry-queue
FAILED_QUEUE_NAME=failed-mails

# ============================================
# KeyDB / Redis (連接 MIS 自建的快取)
# 格式: 主機:埠號
# ============================================
KEYDB_URL=keydb-host:6379
KEYDB_STATUS_TTL_DAYS=14

# ============================================
# Microsoft OAuth 2.0 (組織網域郵件發送)
# ============================================
MICROSOFT_TENANT_ID=your-tenant-id
MICROSOFT_CLIENT_ID=your-client-id
MICROSOFT_CLIENT_SECRET=your-client-secret

# ============================================
# SendGrid (非組織網域郵件發送)
# 當寄件者不是組織網域時使用 SendGrid 發送
# ============================================
SENDGRID_API_KEY=your-sendgrid-api-key
ORG_EMAIL_DOMAIN=@ptc-nec.com.tw

# ============================================
# Attachment (附件儲存路徑)
# 建議使用 NFS 或共享儲存，讓 API 與 Worker 共用
# ============================================
ATTACHMENT_VOLUME_PATH=/mnt/shared-storage/mail-proxy-attachments
MAX_ATTACHMENT_SIZE_MB=25

# ============================================
# JWT (API Token 簽名密鑰)
# 請使用強密碼，建議至少 32 字元
# ============================================
JWT_SECRET=your-jwt-secret-key-change-this-in-production

# ============================================
# Worker 設定
# WORKER_CONCURRENCY: 每個 Worker 容器同時處理的 goroutine 數量
# WORKER_PREFETCH: RabbitMQ 預取訊息數量
# WORKER_REPLICAS: Worker 容器數量 (水平擴展)
# 最佳實踐：WORKER_PREFETCH >= WORKER_CONCURRENCY
# ============================================
WORKER_CONCURRENCY=10
WORKER_PREFETCH=10
MAX_RETRY_COUNT=5
WORKER_REPLICAS=2

# ============================================
# Admin Token 初始化設定
# 啟動時自動建立 MIS Admin Token
# ============================================
INIT_ADMIN_TOKEN=true
ADMIN_TOKEN_NAME=MIS Admin

# ============================================
# 外部網路設定
# MIS 自建基礎設施的 Docker 網路名稱
# ============================================
EXTERNAL_NETWORK_NAME=infra-network

# ============================================
# SMTP Inbound Server 設定
# 接收外部 SMTP 郵件並轉發到 RabbitMQ
# ============================================
# SMTP 主要監聽埠號（不使用 25 以避免權限問題）
SMTP_INBOUND_PORT=2525
# SMTP TLS 監聽埠號（可選）
SMTP_INBOUND_TLS_PORT=1587
# 是否啟用 TLS（生產環境建議啟用）
SMTP_TLS_ENABLED=false
# 是否需要 SMTP 認證
SMTP_AUTH_REQUIRED=false
# 允許的寄件網域（逗號分隔，空白表示允許全部）
# 範例: @ptc-nec.com.tw,@example.com
SMTP_ALLOWED_DOMAINS=
# 最大郵件大小（MB）
SMTP_MAX_MESSAGE_SIZE_MB=25
