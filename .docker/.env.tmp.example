# .docker/.env.tmp.example
# 郵件代理系統臨時環境 (TMP Environment)
#
# 本地服務: postgresql, api, worker, smtp-receiver
# 外部服務: keydb, rabbitmq (連線 MIS 既有)
#
# ⚠️ 重要：請複製此檔案為 .env.tmp 並填入正確的值

# ============================================
# Environment
# ============================================
APP_ENV=production
IMAGE_TAG=latest

# ============================================
# Docker Network
# 外部網路名稱（連接 MIS 既有服務）
# ============================================
EXTERNAL_NETWORK_NAME=mis-network

# ============================================
# PostgreSQL (本地服務)
# ============================================
POSTGRES_USER=smtp_user
POSTGRES_PASSWORD=<your_strong_password_here>
POSTGRES_DB=smtp_service
POSTGRES_PORT=5432
# 連線池設定
DATABASE_MAX_OPEN_CONNS=50
DATABASE_MAX_IDLE_CONNS=10
DATABASE_CONN_MAX_LIFETIME=300

# ============================================
# RabbitMQ (MIS 既有服務)
# 請填入 MIS 提供的連線資訊
# ============================================
RABBITMQ_HOST=<mis-rabbitmq-host>
RABBITMQ_PORT=5672
RABBITMQ_USER=<rabbitmq-username>
RABBITMQ_PASSWORD=<rabbitmq-password>
MAIL_QUEUE_NAME=mail-queue

# ============================================
# KeyDB (MIS 既有服務)
# 請填入 MIS 提供的連線資訊
# ============================================
KEYDB_HOST=<mis-keydb-host>
KEYDB_PORT=6379
KEYDB_PASSWORD=<keydb-password-if-required>
KEYDB_STATUS_TTL_DAYS=14

# ============================================
# Microsoft OAuth 2.0 (組織網域郵件發送)
# Azure AD 應用程式註冊資訊
# ============================================
MICROSOFT_TENANT_ID=<your-azure-tenant-id>
MICROSOFT_CLIENT_ID=<your-azure-client-id>
MICROSOFT_CLIENT_SECRET=<your-azure-client-secret>

# ============================================
# SendGrid (非組織網域郵件發送)
# ============================================
SENDGRID_API_KEY=<your-sendgrid-api-key>
ORG_EMAIL_DOMAIN=@ptc-nec.com.tw

# ============================================
# Attachment Volume (附件儲存路徑)
# 正式環境建議使用 NFS 或 SAN 掛載
# ============================================
ATTACHMENT_VOLUME_PATH=/mnt/mail-proxy/attachments
MAX_ATTACHMENT_SIZE_MB=50

# ============================================
# API 服務設定
# ============================================
API_PORT=8080
GIN_MODE=release

# ============================================
# Worker 設定
# 正式環境建議值：根據可用 CPU 核心數調整
# 最佳實踐：WORKER_PREFETCH >= WORKER_CONCURRENCY
# ============================================
WORKER_CONCURRENCY=20
WORKER_PREFETCH=25
MAX_RETRY_COUNT=5

# ============================================
# JWT 認證
# ⚠️ 正式環境請使用強度足夠的隨機密鑰 (至少 32 字元)
# ============================================
JWT_SECRET=<your-production-jwt-secret-min-32-chars>

# ============================================
# Admin Token 初始化設定
# 首次啟動時自動建立管理員 Token
# ============================================
INIT_ADMIN_TOKEN=true
ADMIN_TOKEN_NAME=MIS Admin TMP

# ============================================
# SMTP Inbound Server 設定
# 接收外部 SMTP 郵件並轉發到 RabbitMQ
# ============================================
# SMTP 主要監聽埠號
SMTP_INBOUND_PORT=2525
# SMTP TLS 監聽埠號
SMTP_INBOUND_TLS_PORT=1587
# TLS 設定（正式環境建議啟用）
SMTP_TLS_ENABLED=true
SMTP_TLS_CERT_PATH=./certs
SMTP_TLS_CERT_FILE=/app/certs/server.crt
SMTP_TLS_KEY_FILE=/app/certs/server.key
# SMTP 認證設定（正式環境建議啟用）
SMTP_AUTH_REQUIRED=true
# 允許的寄件網域（逗號分隔，空白表示允許全部）
# 範例: @ptc-nec.com.tw,@example.com
SMTP_ALLOWED_DOMAINS=@ptc-nec.com.tw
# 最大郵件大小（MB）
SMTP_MAX_MESSAGE_SIZE_MB=50

# ============================================
# 日誌設定
# ============================================
LOG_LEVEL=info
LOG_FORMAT=json
